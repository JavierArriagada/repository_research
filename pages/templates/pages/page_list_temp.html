{% extends 'core/base.html' %}
{% load static %}
{% block title %}Páginas{% endblock %}
{% block content %}
{% include 'pages/includes/pages_menu.html' %}
<main role="main">
  <table class="table mb-0">
    <thead>
      <tr>
        <th>Cover</th>
        <th>Title</th>
        <th>Download</th>
        <th>Download</th>
        {% if request.user.is_staff %}
          <th>Edit</th>
        {% endif %}
        
      </tr>
    </thead>
    <tbody>
      {% for page in page_list %}
        <tr>
          <td>
            {% if page.cover %}
              <img src="{{ page.cover.url }}" alt="{{ page.title }}" style="width:100px;">
            {% else %}
              <span class="text-muted">No cover</span>
            {% endif %}
          </td>
          <td>
            <p><a href="{% url 'pages:page' page.id page.title|slugify %}">{{ page.title }}</a>
          </td>
          <td>
            <a href="{{ page.pdf.url }}" class="btn btn-primary btn-sm btn-block" target="_blank">
              Download PDF
            </a>
            {% if request.user != page.created_by %}
                <a href="{% url 'messenger:start' page.created_by.username %}" class="btn btn-primary btn-sm btn-block mt-3">
                  Enviar Mensaje
                </a>
            {% endif %}
          </td>
          <td>
            
            <p class="profile-data">
              <b>{{profile.user|truncatechars:"16"}}</b><br>
              <a href="{% url 'profiles:detail' page.created_by %}">Ver perfil</a>
            </p>
          </td> 

            {% if request.user.is_staff %}
            <td>
              <a href="{% url 'pages:update' page.id %}">Editar</a>
              <a href="{% url 'pages:delete' page.id %}">Borrar</a>
            </td> 
            {% endif %}

            
          
        </tr>
      {% endfor %}
    </tbody>
  </table>



  <div class="container mb-4">
    {% for page in page_list|dictsort:"id" reversed %}
      <div class="row mt-3">
        <div class="col-md-9 mx-auto">
          <h2 class="mb-4">{{page.title}}</h2>
          <div>
            <p>{{page.content|striptags|safe|truncatechars:"200"}}</p>
            
            <p><a href="{% url 'pages:page' page.id page.title|slugify %}">Leer más</a>
              
              {% if request.user.is_staff %}
                | <a href="{% url 'pages:update' page.id %}">Editar</a>
                | <a href="{% url 'pages:delete' page.id %}">Borrar</a>
              {% endif %}
             
            </p>

            <p>{{page.id}}</p>
            <p>{{page.pdf}}</p>
            <p>{{page.created_by}}</p>
            

            <p class="profile-data">
              <b>{{profile.user|truncatechars:"16"}}</b><br>
              <a href="{% url 'profiles:detail' page.created_by %}">Ver perfil</a>
            </p>

            {% if request.user != page.created_by %}
                <a href="{% url 'messenger:start' page.created_by.username %}" class="btn btn-primary btn-sm btn-block mt-3">
                  Enviar Mensaje
                </a>
            {% endif %}

          </div>
        </div>
      </div>
    {% endfor %}

    <p>{{page_list}}</p>
  </div>

  <div class="container mb-4" id="bMosaicBox">
    {% for page in page_list|dictsort:"id" reversed %}
    <div id="{{page.id}}"> 
      {{page.title}}
      <a href="{% url 'pages:page' page.id page.title|slugify %}"  title={{page.title}}>
        <div >
          <img src="{{ page.cover.url }}">
        </div>
      </a>
    </div>
    {% endfor %}
  </div>

  
</main>
{% endblock %}
